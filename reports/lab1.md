# lab1报告

![img](file:///C:\Users\Hp\AppData\Local\Temp\QQ_1723375848482.png)

task_info测试用例已通过

#### 问答题

1.a0代表着内核栈的栈顶，两种使用情况分别为（1）最开始的时候由初始化的trapContext进行用户栈的初始化（2）之后的作用为将内核栈的内容加载到用户栈上

2.三个寄存器的作用如下

| CSR 名   | 该 CSR 与 Trap 相关的功能                                    |
| -------- | ------------------------------------------------------------ |
| sstatus  | `SPP` 等字段给出 Trap 发生之前 CPU 处在哪个特权级（S/U）等信息 |
| sepc     | 当 Trap 是一个异常的时候，记录 Trap 发生之前执行的最后一条指令的地址 |
| sscratch | 内核栈的栈顶                                                 |

3.前文提到：“ 如 `x0` 被硬编码为 0 ，它自然不会有变化；还有 `tp(x4)` 寄存器，除非我们手动出于一些特殊用途使用它，否则一般也不会被用到。”

4.两个寄存器相互交换内容，sscratch现在指向内核栈栈顶，sp指向用户栈栈顶，与__alltraps的第一条汇编指令正好相反

5.发生在sret指令，这条指令将使计算机跳转到sepc指明的指令地址上去，即完成了OS和APP的切换

6.现在sp和sscratch的内容交换，sp指向内核栈栈顶，而sscratch指向用户栈栈顶

7.由L38调用trap_handler指令进入S态，之后会进行系统调用
